<!DOCTYPE html>
<html>
<head>
  <title>Formfix Group: Net</title>

  <adorn>
    <foundation></foundation>
    <finish></finish>
  </adorn>


</head>
<body>


<p>asdfasdf</p>
<div>
    <h3>Use HTTP GET</h3>
    <form class="fix" action="http://demo4555572.mockable.io/expense/12" method="GET">
        <input type="text" name="textInput" value="using GET" />
        <input type="submit" name="submitInput" />
    </form>
</div>

<div>
    <h3>Use HTTP POST</h3>
    <form class="fix" action="http://demo4555572.mockable.io/expense/" method="POST">
        <input type="text" name="textInput" value="using POST" />
        <input type="text" name="textInput2" value="using POST2" />
        <input type="submit" name="submitInput" />
    </form>
</div>

<div>
    <h3>Use HTTP PUT</h3>
    <form class="fix" action="http://demo4555572.mockable.io/expense/12" method="PUT">
        <input type="text" name="textInput" value="using PUT" />
        <input type="text" name="textInput2" value="using PUT2" />
        <input type="submit" name="submitInput" />
    </form>
</div>

<div>
    <h3>Use HTTP PATCH</h3>
    <form class="fix" action="http://demo4555572.mockable.io/user/12" method="PATCH">
        <input type="text" name="textInput" value="using PATCH" />
        <input type="text" name="textInput2" value="using PATCH2" />
        <input type="submit" name="submitInput" />
    </form>
</div>

<div>
    <h3>Use HTTP DELETE</h3>
    <form class="fix" action="http://demo4555572.mockable.io/expense/12" method="DELETE">
        <input type="text" name="textInput" value="using DELETE" />
        <input type="submit" name="submitInput" />
    </form>
</div>

</body>
<self>
  <precog>
    
    <script type="text/javascript">
      var formfix = { core: {}, net: {} }

      formfix.core.encodeQueryData = function(data)
      {
         var ret = [];
         for (var d in data)
            ret.push(encodeURIComponent(d) + "=" + encodeURIComponent(data[d]));
         return ret.join("&");
      }

      // mock apis:
      // http://demo4555572.mockable.io/user/12 
      // http://todos.stoplight.io/

      testSuccess = function(e) {
        console.log('begin success')
        console.log(e)
        console.log('end success')
      }

      testError = function(e) {
        console.log('begin error')
        console.log(e)
        console.log('end error')
      }
    </script>

  </precog>
  <cog>

    
    <script type="text/javascript">

      /* polyfill: method.net.formfix.js */
      var forms = document.body.querySelectorAll("form.fix");    
      console.log(forms)

      for (i = 0; i < forms.length; ++i) {
        console.log(i+' ...');

        forms[i].addEventListener("submit", function(e) {
          e.preventDefault();
          formfix.net.xhr( e.target.attributes.action.value, e.target.attributes.method.value, testSuccess, testError, e.target )
          console.log('attr', e.target.attributes);

        });


      }
      console.log('done.')

    </script>

    <script type="text/javascript">
      /* polyfill: xhr.net.formfix.js */
      // delete: http://stackoverflow.com/questions/9156334/issuing-delete-request-using-xmlhttprequest
      // options: http://stackoverflow.com/questions/16568735/options-request-instead-of-put-in-xmlhttprequest
      // patch: http://stackoverflow.com/questions/11461414/ajax-json-doesnt-get-sent-in-patch-only
      // get & post & put: http://blog.garstasio.com/you-dont-need-jquery/ajax/
      formfix.net.xhr = function( path, method, success, error, form ) {
        method = method.toUpperCase() || 'GET'
        
        var xhr = new XMLHttpRequest()
        xhr.onreadystatechange = function()
        {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) { // xhr.readyState == 4 && xhr.status == 200?
                    if (success) success(JSON.parse(xhr.responseText))
                } else {
                    if (error) error(xhr)
                }
            }
        }

/*

        // prepare data depends on method
        var preparedData = ''
        if (method == 'GET') {
          // require param be in path (?)
        }
        else if (method == 'POST' || method == 'PUT' || method == 'PATCH') {
          // require param be in path (?)
          preparedData = formfix.core.encodeQueryData(data);
        }
        else if (method == 'DELETE') {
          // require param be in path (?)
        }
*/
        // open it
        xhr.open(method, encodeURI(path), true)
/*
        // use header per method
        if (method == 'POST' || method == 'PUT' || method == 'PATCH') {
          xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        }
*/


        xhr.send(new FormData(form))

        return false
      }
/*

var formElement = document.querySelector("form");
var request = new XMLHttpRequest();
request.open("POST", "submitform.php");
request.send(new FormData(formElement));
*/
    </script>
  </cog>
</self>
</html>